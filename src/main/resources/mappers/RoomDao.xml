<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ustrip.dao.RoomDao">  
 
 <select id="selectCountByRoomTypeIdAndHotelId" parameterType="map" resultType="int">
 		SELECT COUNT(1) FROM eb_hotel_room_type WHERE hotelId = #{hotelId} AND room_type_id = #{roomTypeId}
 </select>

 
 <insert id="addMappingByHotelAndRoomType" parameterType="map" >
 		INSERT INTO eb_hotel_room_type( hotelId, room_type_id,status,update_time)  VALUES (#{hotelId}, #{roomTypeId}, 1,NOW())
 </insert>
 
 
 <update id="disableHotelRoomType" parameterType="map" >
 		UPDATE eb_hotel_room_type SET status = #{status},update_time = NOW() WHERE hotelId = #{hotelId} and room_type_id = #{roomTypeId};
 		UPDATE eb_plan set status = 2 WHERE hotelId = #{hotelId} and room_type_id = #{roomTypeId};
 </update>
 
 
 
 
 
   <select id="queryRoomTypes" parameterType="java.util.List" resultType="java.util.Map">

      select hotelId, id room_type_id , type_name room_type_name, type_name_zh room_type_name_zh,ctrip_code
      from eb_dict where type = 'room' and hotelId = 0
      union all
      select eb_hotel_room_type.hotelId, room_type_id ,eb_dict.type_name,eb_dict.type_name_zh,ctrip_code
      from eb_hotel_room_type
      inner join eb_dict on eb_hotel_room_type.room_type_id = eb_dict.id
      where eb_hotel_room_type.status = 1 and eb_hotel_room_type.hotelId IN
      <foreach item="item" collection="list" separator="," open="(" close=")" index="">
          #{item.hotelId, jdbcType=INTEGER}
      </foreach>

  </select>
 
 
 <select id="queryBedListByHotelIdAndRoomTypeId" parameterType="map" resultType="java.util.Map">
		SELECT code,name,quantity,category_code
		FROM eb_map_bed_cbed 
		INNER JOIN ctrip_d_bed_type  on eb_map_bed_cbed.ctrip_bed_id = ctrip_d_bed_type.`code`
		WHERE eb_bed_id = (
			SELECT bed_type_id FROM eb_plan WHERE  hotelId = #{hotelId} AND room_type_id = #{room_type_id} AND status = 1 limit 1
		)
 </select>
 
</mapper>
